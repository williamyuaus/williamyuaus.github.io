<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"williamyu.live","root":"/","images":"/images","scheme":"Gemini","version":"8.7.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":true,"nav":null,"activeClass":"utterances"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta name="description" content="IntroTo develop a single-page application, Spring Boot and Vue can be a good choice. When you finished the development stage, it is time to deploy the app online. Traditionally, you may need to write">
<meta property="og:type" content="article">
<meta property="og:title" content="How to deploy a Spring Boot and Vue application on AWS EC2 using Docker">
<meta property="og:url" content="https://williamyu.live/2021/08/28/How-to-deploy-a-Spring-Boot-and-Vue-application-on-AWS-EC2-using-Docker/index.html">
<meta property="og:site_name" content="William Yu">
<meta property="og:description" content="IntroTo develop a single-page application, Spring Boot and Vue can be a good choice. When you finished the development stage, it is time to deploy the app online. Traditionally, you may need to write">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/williamyuaus/blog-img/master/20210826214826.png">
<meta property="og:image" content="https://raw.githubusercontent.com/williamyuaus/blog-img/master/20210826220735.png">
<meta property="og:image" content="https://raw.githubusercontent.com/williamyuaus/blog-img/master/20210826221030.png">
<meta property="og:image" content="https://raw.githubusercontent.com/williamyuaus/blog-img/master/20210826221710.png">
<meta property="og:image" content="https://raw.githubusercontent.com/williamyuaus/blog-img/master/20210827101619.png">
<meta property="og:image" content="https://raw.githubusercontent.com/williamyuaus/blog-img/master/20210826223716.png">
<meta property="og:image" content="https://raw.githubusercontent.com/williamyuaus/blog-img/master/20210827220851.png">
<meta property="og:image" content="https://raw.githubusercontent.com/williamyuaus/blog-img/master/20210827221418.png">
<meta property="article:published_time" content="2021-08-28T02:47:00.000Z">
<meta property="article:modified_time" content="2021-08-28T05:30:07.042Z">
<meta property="article:author" content="William Yu">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/williamyuaus/blog-img/master/20210826214826.png">


<link rel="canonical" href="https://williamyu.live/2021/08/28/How-to-deploy-a-Spring-Boot-and-Vue-application-on-AWS-EC2-using-Docker/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://williamyu.live/2021/08/28/How-to-deploy-a-Spring-Boot-and-Vue-application-on-AWS-EC2-using-Docker/","path":"2021/08/28/How-to-deploy-a-Spring-Boot-and-Vue-application-on-AWS-EC2-using-Docker/","title":"How to deploy a Spring Boot and Vue application on AWS EC2 using Docker"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>How to deploy a Spring Boot and Vue application on AWS EC2 using Docker | William Yu</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">William Yu</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">William Yu's Blog</p>
      <img class="custom-logo-image" src="/images/William-Yu-Logo.png" alt="William Yu">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Intro"><span class="nav-number">1.</span> <span class="nav-text">Intro</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Install-Docker-in-AWS-EC2-instance"><span class="nav-number">2.</span> <span class="nav-text">Install Docker in AWS EC2 instance</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Deploy-the-back-end-service"><span class="nav-number">3.</span> <span class="nav-text">Deploy the back-end service</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Compile-and-build-the-JAR-file"><span class="nav-number">3.1.</span> <span class="nav-text">Compile and build the JAR file</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Upload-the-JAR-file-to-the-server"><span class="nav-number">3.2.</span> <span class="nav-text">Upload the JAR file to the server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fix-Permissions-0644-error"><span class="nav-number">3.3.</span> <span class="nav-text">Fix Permissions 0644 error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Build-the-Docker-image-for-the-Java-service"><span class="nav-number">3.4.</span> <span class="nav-text">Build the Docker image for the Java service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Start-the-container-for-back-end-service"><span class="nav-number">3.5.</span> <span class="nav-text">Start the container for back-end service</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Deploy-the-front-end-service"><span class="nav-number">4.</span> <span class="nav-text">Deploy the front-end service</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Prepare-for-the-Nginx"><span class="nav-number">4.1.</span> <span class="nav-text">Prepare for the Nginx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Build-the-production-files-for-the-front-end-project"><span class="nav-number">4.2.</span> <span class="nav-text">Build the production files for the front-end project</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Upload-the-front-end-project-files"><span class="nav-number">4.3.</span> <span class="nav-text">Upload the front-end project files</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-and-start-the-Nginx-container-in-Docker"><span class="nav-number">4.4.</span> <span class="nav-text">Install and start the Nginx container in Docker</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="William Yu"
      src="/images/william-avatar.jpeg">
  <p class="site-author-name" itemprop="name">William Yu</p>
  <div class="site-description" itemprop="description">Software Developer from the user side</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/williamyuaus" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;williamyuaus" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:williamyuaus@gmail.com" title="E-Mail → mailto:williamyuaus@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://williamyu.live/2021/08/28/How-to-deploy-a-Spring-Boot-and-Vue-application-on-AWS-EC2-using-Docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/william-avatar.jpeg">
      <meta itemprop="name" content="William Yu">
      <meta itemprop="description" content="Software Developer from the user side">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="William Yu">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          How to deploy a Spring Boot and Vue application on AWS EC2 using Docker
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-08-28 12:47:00 / Modified: 15:30:07" itemprop="dateCreated datePublished" datetime="2021-08-28T12:47:00+10:00">2021-08-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><img src="https://raw.githubusercontent.com/williamyuaus/blog-img/master/20210826214826.png"></p>
<h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>To develop a single-page application, Spring Boot and Vue can be a good choice. When you finished the development stage, it is time to deploy the app online.</p>
<p>Traditionally, you may need to write scripts to start your java service, and you need to do a lot of configuration for the Nginx server.</p>
<p>To make the process easier and more efficient, I would recommend using Docker to deploy the app. You may find it a little bit difficult to learn at the beginning, but you will benefit from the learning since Docker could help you a lot.</p>
<span id="more"></span>

<h2 id="Install-Docker-in-AWS-EC2-instance"><a href="#Install-Docker-in-AWS-EC2-instance" class="headerlink" title="Install Docker in AWS EC2 instance"></a>Install Docker in AWS EC2 instance</h2><p>Once you have created an AWS EC2 instance, you need to install Docker in the instance. I have written a post about this process, you may check it: <a href="https://williamyu.live/2021/07/26/How-to-install-Docker-in-AWS-EC2-instances/">https://williamyu.live/2021/07/26/How-to-install-Docker-in-AWS-EC2-instances/</a></p>
<h2 id="Deploy-the-back-end-service"><a href="#Deploy-the-back-end-service" class="headerlink" title="Deploy the back-end service"></a>Deploy the back-end service</h2><h3 id="Compile-and-build-the-JAR-file"><a href="#Compile-and-build-the-JAR-file" class="headerlink" title="Compile and build the JAR file"></a>Compile and build the JAR file</h3><p>Firstly, you should compile and build the JAR file for your Spring Boot project. You may need to change the production configuration settings first. After you have done this, you can follow similar steps to get the JAR file.<br><img src="https://raw.githubusercontent.com/williamyuaus/blog-img/master/20210826220735.png"></p>
<p><img src="https://raw.githubusercontent.com/williamyuaus/blog-img/master/20210826221030.png"></p>
<h3 id="Upload-the-JAR-file-to-the-server"><a href="#Upload-the-JAR-file-to-the-server" class="headerlink" title="Upload the JAR file to the server"></a>Upload the JAR file to the server</h3><p>Next, you need to upload the JAR file to the server. I would use <code>/home/ec2-user/</code> as my working directory. So, you may need to create a new directory <code>\eladmin</code> and use scp server to transfer the JAR file from your local computer to the server.<br><img src="https://raw.githubusercontent.com/williamyuaus/blog-img/master/20210826221710.png"></p>
<p>The command for creating the directory is <code>mkdir eladmin</code>. The command for scp server to transfer the JAR file is:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r -i /Users/willyu/dev/deploy/college-system-keys.cer /Users/willyu/dev/deploy/eladmin-system-2.6.jar ec2-user@IP:/home/ec2-user/eladmin</span><br></pre></td></tr></table></figure>

<h3 id="Fix-Permissions-0644-error"><a href="#Fix-Permissions-0644-error" class="headerlink" title="Fix Permissions 0644 error"></a>Fix Permissions 0644 error</h3><p>You may get Permissions 0644 error when you were trying to use scp command. It is because the private key cannot be accessed by others. The full error message is showing like this:<br><img src="https://raw.githubusercontent.com/williamyuaus/blog-img/master/20210827101619.png"></p>
<p>To fix this issue, you need to give the permission to write and read the file with this command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 600 /Users/****.cer</span><br></pre></td></tr></table></figure>

<p>Then, the password is required and you will solve the issue.</p>
<h3 id="Build-the-Docker-image-for-the-Java-service"><a href="#Build-the-Docker-image-for-the-Java-service" class="headerlink" title="Build the Docker image for the Java service"></a>Build the Docker image for the Java service</h3><p>To create the Docker image for the Java service, you need to create a Dockerfile for the image. The file should be named as Dockerfile without any extension. The content of the file is:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM java:8</span><br><span class="line">ARG JAR_FILE=./*.jar</span><br><span class="line">COPY $&#123;JAR_FILE&#125; app.jar</span><br><span class="line">ENV TZ=Australia/Melbourne</span><br><span class="line">ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]</span><br></pre></td></tr></table></figure>


<p>The file should be uploaded to the same directory with the JAR file in <code>/home/ec2-user/eladmin/</code>.</p>
<p>Then, you need to create the image using the command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t eladmin .</span><br></pre></td></tr></table></figure>

<h3 id="Start-the-container-for-back-end-service"><a href="#Start-the-container-for-back-end-service" class="headerlink" title="Start the container for back-end service"></a>Start the container for back-end service</h3><p>Before starting the back-end service container, you may need to install and run redis in the Docker.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --name redis --restart=always -p 6379:6379 redis</span><br></pre></td></tr></table></figure>

<p>Now, you can use the following command to run the container back-end server.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">--name eladmin --restart always \</span><br><span class="line">-p 8000:8000 \</span><br><span class="line">-e &quot;TZ=Australia/Melbourne&quot; \</span><br><span class="line">-e REDIS_HOST=172.17.0.1 \</span><br><span class="line">-v /home/ec2-user/data/:/home/eladmin/ \</span><br><span class="line">eladmin</span><br></pre></td></tr></table></figure>

<p>You can test your back-end service in the browser or postman.<br><img src="https://raw.githubusercontent.com/williamyuaus/blog-img/master/20210826223716.png"></p>
<h2 id="Deploy-the-front-end-service"><a href="#Deploy-the-front-end-service" class="headerlink" title="Deploy the front-end service"></a>Deploy the front-end service</h2><h3 id="Prepare-for-the-Nginx"><a href="#Prepare-for-the-Nginx" class="headerlink" title="Prepare for the Nginx"></a>Prepare for the Nginx</h3><p>To deploy the front-end service, we use Nginx as the web server. Firstly, we need to create some directories for Nginx.</p>
<ul>
<li>/home/ec2-user/nginx/conf.d is for configuration files;</li>
<li>/home/ec2-user/nginx/cert is for storing SSL certificate;</li>
<li>/home/ec2-user/nginx/html is for storing website files;</li>
<li>/home/ec2-user/nginx/logs if for storing logs.</li>
<li>/home/ec2-user/nginx.conf is the default Nginx configuration file.</li>
</ul>
<p>The default Nginx configuration file is defined as below:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">user  nginx;</span><br><span class="line">worker_processes  auto;</span><br><span class="line"></span><br><span class="line">error_log  /var/log/nginx/error.log notice;</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    client_max_body_size 100M;</span><br><span class="line"></span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then, we need to define the custom configuration file for the reverse proxy. So, we need to create a file named <code>eladmin.conf</code> in the <code>/home/ec2-user/nginx/conf.d</code> directory. The content of the file is:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">server</span><br><span class="line">    &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name domain/IP;</span><br><span class="line">        index index.html;</span><br><span class="line">        root  /usr/share/nginx/html/eladmin/dist;  #dist upload directory </span><br><span class="line">        client_max_body_size 800M;</span><br><span class="line"></span><br><span class="line">        # avoid 404 error</span><br><span class="line">        location / &#123;</span><br><span class="line">          try_files $uri $uri/ @router;</span><br><span class="line">          index  index.html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location @router &#123;</span><br><span class="line">          rewrite ^.*$ /index.html last;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # socket</span><br><span class="line">        location /api &#123;</span><br><span class="line">          proxy_pass http://172.17.0.1:8000;</span><br><span class="line">          proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">          proxy_set_header X-Forwarded-Port $server_port;</span><br><span class="line">          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">          proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">          proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # auth socket</span><br><span class="line">        location /auth &#123;</span><br><span class="line">          proxy_pass http://172.17.0.1:8000;</span><br><span class="line">          proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">          proxy_set_header X-Forwarded-Port $server_port;</span><br><span class="line">          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">          proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">          proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # WebSocket service</span><br><span class="line">        location /webSocket &#123;</span><br><span class="line">          proxy_pass http://172.17.0.1:8000;</span><br><span class="line">          proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">          proxy_set_header X-Forwarded-Port $server_port;</span><br><span class="line">          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">          proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">          proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # avatar</span><br><span class="line">        location /avatar &#123;</span><br><span class="line">          proxy_pass http://172.17.0.1:8000;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # files</span><br><span class="line">        location /file &#123;</span><br><span class="line">          proxy_pass http://172.17.0.1:8000;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Build-the-production-files-for-the-front-end-project"><a href="#Build-the-production-files-for-the-front-end-project" class="headerlink" title="Build the production files for the front-end project"></a>Build the production files for the front-end project</h3><p>After the preparation for the Nginx server, we need to build the production files for the front-end project. We use this command to build the production files:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build:prod</span><br></pre></td></tr></table></figure>

<p>When the building process is finished, you will get the production files in the <code>dist</code> folder as below.<br><img src="https://raw.githubusercontent.com/williamyuaus/blog-img/master/20210827220851.png"></p>
<h3 id="Upload-the-front-end-project-files"><a href="#Upload-the-front-end-project-files" class="headerlink" title="Upload the front-end project files"></a>Upload the front-end project files</h3><p>Since the directory in container <code>/usr/share/nginx/html/eladmin/dist</code> is binding with the directory <code>/home/ec2-user/nginx/html</code> in the host server. Therefore, we should upload the front-end project files to this directory.</p>
<p>We can use the scp server to upload the production files to the directory.<br><img src="https://raw.githubusercontent.com/williamyuaus/blog-img/master/20210827221418.png"></p>
<h3 id="Install-and-start-the-Nginx-container-in-Docker"><a href="#Install-and-start-the-Nginx-container-in-Docker" class="headerlink" title="Install and start the Nginx container in Docker"></a>Install and start the Nginx container in Docker</h3><p>Now, everything is ready. It is time to install the Nginx container in Docker with the commands:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">--name nginx --restart always \</span><br><span class="line">-p 80:80 -p 443:443 \</span><br><span class="line">-e &quot;TZ=Australia/Melbourne&quot; \</span><br><span class="line">-v /home/ec2-user/nginx/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">-v /home/ec2-user/nginx/conf.d:/etc/nginx/conf.d \</span><br><span class="line">-v /home/ec2-user/nginx/logs:/var/log/nginx \</span><br><span class="line">-v /home/ec2-user/nginx/cert:/etc/nginx/cert \</span><br><span class="line">-v /home/ec2-user/nginx/html:/usr/share/nginx/html \</span><br><span class="line">nginx:alpine</span><br></pre></td></tr></table></figure>

<p>Then, start the Nginx server in Docker with the command:<br><code>docker start nginx</code></p>
<p>Congurationlations, you finished all the steps of deployment for the Spring Boot and Vue app in the AWS EC2 instance with Docker.</p>
<p>Enjoy!</p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/08/27/Fix-413-Request-Entity-Too-Large-Error/" rel="prev" title="Fix 413 Request Entity Too Large Error">
                  <i class="fa fa-chevron-left"></i> Fix 413 Request Entity Too Large Error
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">William Yu</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  




<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"williamyuaus/blog_comments","issue_term":"pathname","theme":"preferred-color-scheme"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
